# План улучшенного пайплайна обработки шин для lama

## 1. Анализ текущего пайплайна
- Исходные данные: разные размеры, пропорции, фоны (светлый/тёмный/непрозрачный).
- Шина — основной объект, но может быть перекрыта логотипом/надписью (размечено в YOLO8).
- YOLO8: детектирует логотипы (и другие посторонние объекты), создаёт маски. Есть маска самой шины.
- Маскирование и инпейтинг: маски логотипа и шины миксуются. Логотип удаляется, под ним восстанавливается изображение шины (lama).
- Удаление фона: после инпейтинга удаляется фон, обрезаются прозрачные пиксели.
- Финальная сборка: шина размещается на шаблонном фоне, добавляется текстовая информация. Все изображения приводятся к размеру 321x482 и нужному ракурсу.

## 2. Ключевые проблемы и точки роста
1. Нестандартные пропорции и ракурсы шин
2. Разные фоны и их качество
3. Качество инпейтинга под логотипом
4. Автоматизация выравнивания и центрирования

## 3. Рекомендации по улучшению пайплайна
### A. Предобработка и нормализация шин
- Автоматическое центрирование и ресайз
- Автоматическое выравнивание ракурса
- Автоматическое удаление фона

### B. Улучшение генерации масок для lama
- Использовать реальные маски логотипов из датасета YOLO8
- Добавить немного случайности
- Не использовать free-form/random stroke для обучения lama

### C. Постобработка
- Контроль качества
- Финальный ресайз

### D. Автоматизация пайплайна
- Единый скрипт, который:
  1. Получает url изображения
  2. Скачивает и сохраняет оригинал
  3. Детектирует шину и логотипы (YOLO8)
  4. Создаёт маски
  5. Удаляет логотип (lama)
  6. Удаляет фон (по маске шины)
  7. Центрирует, выравнивает, ресайзит шину
  8. Собирает финальное изображение на шаблоне
  9. Добавляет текстовую информацию

## 4. Пример улучшенного пайплайна (алгоритм)
1. Скачать изображение
2. Детектировать шину и логотипы (YOLO8)
3. Создать маску логотипа (bbox из YOLO8)
4. Создать маску шины (bbox или сегментация)
5. Смешать маски (логотип + шина)
6. Удалить логотип (lama, обученная на реальных bbox логотипов)
7. Удалить фон (по маске шины)
8. Обрезать по минимальному bbox шины
9. Повернуть шину вертикально (если нужно)
10. Центрировать и pad до 321x482
11. Собрать финальное изображение на шаблоне
12. Добавить текстовую информацию

## 5. Что даст такой подход
- Максимально реалистичное восстановление рисунка протектора и боковин.
- Одинаковый ракурс, размер и положение шин на финальных изображениях.
- Автоматизация и стандартизация всего процесса.
- Возможность легко масштабировать пайплайн на новые данные. 